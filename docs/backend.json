{
  "entities": {
    "Location": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Location",
      "type": "object",
      "description": "Represents a physical location with rooms and beds.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Location entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the location."
        },
        "latitude": {
          "type": "number",
          "description": "Latitude coordinate of the location."
        },
        "longitude": {
          "type": "number",
          "description": "Longitude coordinate of the location."
        },
        "description": {
          "type": "string",
          "description": "A longer description of the location and its amenities."
        }
      },
      "required": [
        "id",
        "name",
        "latitude",
        "longitude"
      ]
    },
    "Room": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Room",
      "type": "object",
      "description": "Represents a room within a location.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Room entity."
        },
        "locationId": {
          "type": "string",
          "description": "Reference to Location. (Relationship: Location 1:N Room)"
        },
        "name": {
          "type": "string",
          "description": "Name of the room."
        },
        "capacity": {
          "type": "number",
          "description": "Maximum capacity of the room."
        }
      },
      "required": [
        "id",
        "locationId",
        "name",
        "capacity"
      ]
    },
    "Bed": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Bed",
      "type": "object",
      "description": "Represents a bed within a room.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Bed entity."
        },
        "roomId": {
          "type": "string",
          "description": "Reference to Room. (Relationship: Room 1:N Bed)"
        },
        "bedNumber": {
          "type": "string",
          "description": "Identifier of the bed."
        },
        "status": {
          "type": "string",
          "description": "Current status of the bed (available, occupied, reserved)."
        }
      },
      "required": [
        "id",
        "roomId",
        "bedNumber",
        "status"
      ]
    },
    "Occupancy": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Occupancy",
      "type": "object",
      "description": "Represents the occupancy of a bed for a specific period.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Occupancy entity."
        },
        "bedId": {
          "type": "string",
          "description": "Reference to Bed. (Relationship: Bed 1:N Occupancy)"
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the occupancy period.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date of the occupancy period.",
          "format": "date-time"
        },
        "occupantName": {
          "type": "string",
          "description": "Name of the occupant."
        }
      },
      "required": [
        "id",
        "bedId",
        "startDate",
        "endDate",
        "occupantName"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/locations/{locationId}",
        "definition": {
          "entityName": "Location",
          "schema": {
            "$ref": "#/backend/entities/Location"
          },
          "description": "Stores location data. The locationId parameter uniquely identifies each location.",
          "params": [
            {
              "name": "locationId",
              "description": "Unique identifier for the location."
            }
          ]
        }
      },
      {
        "path": "/locations/{locationId}/rooms/{roomId}",
        "definition": {
          "entityName": "Room",
          "schema": {
            "$ref": "#/backend/entities/Room"
          },
          "description": "Stores room data within a specific location. The roomId parameter uniquely identifies each room within a location.",
          "params": [
            {
              "name": "locationId",
              "description": "Unique identifier for the location."
            },
            {
              "name": "roomId",
              "description": "Unique identifier for the room."
            }
          ]
        }
      },
      {
        "path": "/locations/{locationId}/rooms/{roomId}/beds/{bedId}",
        "definition": {
          "entityName": "Bed",
          "schema": {
            "$ref": "#/backend/entities/Bed"
          },
          "description": "Stores bed data within a specific room. The bedId parameter uniquely identifies each bed within a room.",
          "params": [
            {
              "name": "locationId",
              "description": "Unique identifier for the location."
            },
            {
              "name": "roomId",
              "description": "Unique identifier for the room."
            },
            {
              "name": "bedId",
              "description": "Unique identifier for the bed."
            }
          ]
        }
      },
      {
        "path": "/locations/{locationId}/rooms/{roomId}/beds/{bedId}/occupancies/{occupancyId}",
        "definition": {
          "entityName": "Occupancy",
          "schema": {
            "$ref": "#/backend/entities/Occupancy"
          },
          "description": "Stores occupancy data for a specific bed. The occupancyId parameter uniquely identifies each occupancy record.",
          "params": [
            {
              "name": "locationId",
              "description": "Unique identifier for the location."
            },
            {
              "name": "roomId",
              "description": "Unique identifier for the room."
            },
            {
              "name": "bedId",
              "description": "Unique identifier for the bed."
            },
            {
              "name": "occupancyId",
              "description": "Unique identifier for the occupancy record."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to facilitate a clear hierarchy for managing locations, rooms, beds, and occupancy, optimizing for security, scalability, and ease of querying. Locations are stored at the root level, with rooms nested under locations, and beds nested under rooms. Occupancy records are nested under beds, providing a direct link between a bed and its occupancy history.\n\n**Authorization Independence (CRITICAL):**  Authorization is enforced via hierarchical path ownership. No `get()` calls are required, ensuring atomic operations.\n\n**Structural Segregation:** Each entity type (locations, rooms, beds, occupancies) resides in its own collection or subcollection, ensuring homogeneous security posture within each level of the hierarchy.\n\n**Access Modeling:**\n*   Path-Based ownership is implemented from locations down to beds. This means `/locations/{locationId}/rooms/{roomId}/beds/{bedId}` represents a clear ownership chain, where the existence of a document at each level implies ownership.\n*   Occupancies are secured by inheritance from the bed. Only users with access to the bed (implicitly through location and room) can access the occupancy records. Access to locations can be restricted based on user roles, if needed, by creating a top level `roles_location_admin/{uid}` collection.\n\n**QAPs:**\n*   The structure facilitates secure listing of locations, rooms, and beds because each resides in its own collection, making it easy to define security rules to filter based on location-specific criteria, or user roles (if implemented via a `roles_location_admin/{uid}` collection).\n*   The nested structure is optimized for listing occupancies as subcollections, which simplifies security rules based on the bed they belong to. If a user can access a bed, they can access its occupancies.\n\n**Invariants:** Ownership is inherently enforced by the path structure. Timestamps can be added to documents to track creation and modification times, ensuring data integrity."
  }
}